@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}

<!DOCTYPE html>
<html>
<head>
    <title>Page Title</title>
</head>
<body>

    <h3>List Order</h3>
    <input type="date" placeholder="From date" id="from" />
    <input type="date" placeholder="To date" id="to" />
    <input type="button" id="btnSearch" />
    <table>
        <thead>
            <tr>
                <th>OrderId</th>
                <th>CustomerId</th>
                <th>CustomerName</th>
                <th>EmployeeId</th>
                <th>EmployeeName</th>
                <th>EmployeeDepartmentName</th>
                <th>OrderDate</th>
                <th>ShipName</th>
            </tr>
        </thead>
        <tbody id="table-gg">
        </tbody>
    </table>

</body>
<script>
    $(document).ready(() => {
        getAllOrder();
    });
    const getAllOrder = () => $.ajax({
        url: 'https://localhost:7115/api/Order/GetAllOrder',
        method: 'GET',
        contentType: "application/json",
        success: (data) => loadTableData(data),
        error: () => { alert("not found data!") }
    })

    const loadTableData = (data) => {
        $("#table-gg").empty();
        data.forEach(item => {
            var html = `
                                        <tr>
                                        <td>${item.orderId}</td>
                                        <td>${item.customerId}</td>
                                        <td>${item.contactName}</td>
                                        <td>${item.employeeId}</td>
                                        <td>${item.firstName}  ${item.lastName} <a href="javascript:void(0)" data-id="${item.employeeId}" id="deleteEmp">deleteEmployee</a></td>
                                        <td>${item.departmentName}</td>
                                        <td>${item.orderDate}</td>
                                        <td>${item.shipName}</td>
                                        </tr>
                                            `;
            $("#table-gg").append(html);
        });
    }

    $(document).on('click', '#deleteEmp', async function () {
        let id = $(this).attr('data-id');
        const data = await
        $.ajax({
            url: `https://localhost:7115/api/Employee/Delete/${id}`,
            method: 'POST',
            contentType: "application/json",
            success: (data) => console.log(data),
            error: () => { alert("not found data!") }

        });
        getAllOrder();
    })

    $(document).on('click', '#btnSearch', () => {
        let fromDate = $('#from').val(), toDate = $('#to').val();
        $.ajax({
            url: `https://localhost:7115/api/Order/GetOrderByDate/${fromDate}/${toDate}`,
            method: 'GET',
            contentType: "application/json",
            success: (data) => loadTableData(data),
            error: () => { alert("not found data!") }

        });
    });
</script>
</html>

